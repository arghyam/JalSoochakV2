# Default values for commons.
# This is a YAML-formatted file.
# Declare name/value pairs to be passed into your templates.
global:
    containerRegistry: 252649026375.dkr.ecr.ap-south-1.amazonaws.com

replicas: 1
httpPort: 8080
debugPort: 5005
remote_debug:
  enabled: false
appType: ""

ingress:
  enabled: false
  zuul: false
  annotations:
    kubernetes.io/ingress.class: "nginx"
    nginx.ingress.kubernetes.io/use-regex: "true" 
   # nginx.ingress.kubernetes.io/limit-rpm: "300"
  waf: 
    enabled: true
    annotations:
      nginx.ingress.kubernetes.io/lua-resty-waf: "active"  
      nginx.ingress.kubernetes.io/lua-resty-waf-debug: "true"
      nginx.ingress.kubernetes.io/lua-resty-waf-score-threshold: "10"
      nginx.ingress.kubernetes.io/lua-resty-waf-allow-unknown-content-types: "true"
      nginx.ingress.kubernetes.io/lua-resty-waf-process-multipart-body: "false"              

image:
  pullPolicy: IfNotPresent   

affinity:
    preferSpreadAcrossAZ: true

initContainers:
  dbMigration:
    enabled: false
    image:
      pullPolicy: IfNotPresent  
      tag: latest
    env: |

  gitSync:
    enabled: false
    image:
      repository: k8s.gcr.io/git-sync
      tag: v3.1.1
      pullPolicy: IfNotPresent   
    env: |
        - name: "GIT_SYNC_REPO"
          value: "{{ .Values.initContainers.gitSync.repo }}"
        - name: "GIT_SYNC_BRANCH"
          value: "{{ .Values.initContainers.gitSync.branch }}"        
        - name: "GIT_SYNC_DEPTH"
          value: "1"            
        - name: "GIT_SYNC_ONE_TIME"
          value: "true"          
        - name: "GIT_SYNC_SSH"
          value: "true"      
        - name: "GIT_SYNC_ROOT"
          value: "/work-dir"

healthChecks:
    enabled: false
    livenessProbe: |
        httpGet:
            path: "{{ .Values.healthChecks.livenessProbePath }}"
            port: {{ .Values.httpPort }}
        initialDelaySeconds: 30
        timeoutSeconds: 3
        periodSeconds: 60
        successThreshold: 1
        failureThreshold: 5
    readinessProbe: |
        httpGet:
            path: "{{ .Values.healthChecks.readinessProbePath }}"
            port: {{ .Values.httpPort }}
        initialDelaySeconds: 30
        timeoutSeconds: 3
        periodSeconds: 30
        successThreshold: 1
        failureThreshold: 5        

lifecycle:
    preStop:
        exec:
            command:
            - sh
            - -c
            - "sleep 10"

memory_limits: "512Mi"
resources: |
  {{- if eq .Values.appType "java-spring" -}}
  requests:
    memory: {{ .Values.memory_limits | quote }}
  limits:
    memory: {{ .Values.memory_limits | quote }}
  {{- end -}}
## Allows specification of additional environment variables
# extraEnv:
#   java: |
               
## Additional init containers
extraInitContainers: |

## Additional sidecar containers
extraContainers: |

## Add additional volumes and mounts, e. g. for custom themes
extraVolumes: |
extraVolumeMounts: |

additionalLabels: {}

podSecurityContext: {}
  # fsGroup: 2000

securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000            

service:
  additionalAnnotations: {}

serviceMonitor:
  honorLabels: true
  # interval: 2m  

cron:
  concurrencyPolicy: Forbid
  restartPolicy: OnFailure
  httpPort: 8080
  ## Additional sidecar containers
  extraContainers: |

  ## Add additional volumes and mounts
  extraVolumes: |

  ## Add additional mounts
  extraVolumeMounts: |

vpa:
  enabled: false  
  updateMode: "Off"
